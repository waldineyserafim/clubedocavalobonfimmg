<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Painel — Hub | Clube do Cavalo - Bonfim MG</title>
  <meta name="description" content="Hub do painel de administração.">
  <meta property="og:image" content="https://clubedocavalobonfim.com.br/assets/img/logo_CCBMG.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/custom.css?v=op-2025-09-25-hub">
  <link rel="icon" type="image/png" href="assets/img/logo_CCBMG.png">
  <link rel="shortcut icon" href="assets/img/logo_CCBMG.png" type="image/png">
  <style>
    :root{ --brand:#111279; --accent:#2a9d8f; }
    .bg-primary{ background-color:var(--brand)!important; }
    .btn-primary{ background-color:var(--brand)!important; border-color:var(--brand)!important; }
    .btn-outline-primary{ color:var(--brand)!important; border-color:var(--brand)!important; }
    .text-primary{ color:var(--brand)!important; }
    .navbar .container{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; }
    .navbar-brand{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    header { background:#f8f9fa; border-bottom:1px solid #e9ecef; }
    header .container{ padding-top:1rem; padding-bottom:1rem; }
    @media (min-width:768px){ header .container{ padding-top:1.25rem; padding-bottom:1.25rem; } }
    .badge-role{ background:var(--accent); }
    main.container{ padding-top:1rem; padding-bottom:1.25rem; }
    .brand-logo{ height:36px; width:auto; margin-right:.5rem; object-fit:contain; filter:brightness(0) invert(1); }
    @media (min-width: 992px){ .brand-logo{ height:42px; } }
    .app-grid{ display:grid; gap:16px; grid-template-columns: repeat(1,1fr); }
    @media (min-width:576px){ .app-grid{ grid-template-columns: repeat(2,1fr); } }
    @media (min-width:992px){ .app-grid{ grid-template-columns: repeat(4,1fr); } }
    .app-card{ border:1px solid #e9ecef; border-radius:14px; padding:18px; transition:.2s; background:#fff; height:100%; }
    .app-card:hover{ transform: translateY(-2px); box-shadow: 0 10px 24px rgba(17,18,121,.08); }
    .app-card h3{ font-size:1.05rem; margin:0 0 .25rem; }
    .app-card p{ margin:0; color:#6c757d; font-size:.925rem; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
  <div class="container">
    <img class="brand-logo" src="assets/img/logo_CCBMG.png?v=ccbmg-2025-09-25" alt="Logo Clube do Cavalo">
    <a class="navbar-brand fw-bold text-truncate" href="index.html">Clube do Cavalo - Bonfim MG</a>
    <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Alternar navegação">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="nav">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center">
        <li class="nav-item me-2"><a class="nav-link" href="pg_associado.html">Área do Associado</a></li>
        <li class="nav-item"><button id="btnLogout" class="btn btn-sm btn-outline-light">Sair</button></li>
      </ul>
    </div>
  </div>
</nav>

<header>
  <div class="container d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2">
    <div>
      <h1 class="h4 h3-md mb-1">Painel de Administração — Hub</h1>
      <p class="text-secondary mb-0">Escolha o módulo para gerenciar.</p>
    </div>
    <div class="text-end">
      <div class="small">Logado como: <strong id="opName">—</strong></div>
      <span id="opRole" class="badge badge-role d-none text-uppercase">admin</span>
    </div>
  </div>
</header>

<main class="container">
  <div class="app-grid">
    <a class="text-decoration-none" href="admin_associados.html">
      <div class="app-card">
        <h3>Associados</h3>
        <p>Cadastro, busca e financeiro.</p>
      </div>
    </a>
    <a class="text-decoration-none" href="admin_produtos.html">
      <div class="app-card">
        <h3>Produtos</h3>
        <p>Benefícios e ofertas para associados.</p>
      </div>
    </a>
    <a class="text-decoration-none" href="admin_servicos.html">
      <div class="app-card">
        <h3>Serviços</h3>
        <p>Provedores, descrições e imagens.</p>
      </div>
    </a>
    <a class="text-decoration-none" href="admin_classificados.html">
      <div class="app-card">
        <h3>Classificados</h3>
        <p>Moderação, status e pagamentos.</p>
      </div>
    </a>
  </div>
</main>

<footer class="mt-4 py-4 bg-body-tertiary border-top">
  <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
    <div><strong>Clube do Cavalo - Bonfim MG</strong> — Painel de Administração.</div>
    <div class="text-secondary small text-center">
      © 2025 Clube do Cavalo - Bonfim MG. Todos os direitos reservados.<br>
      <span>Sistema de Gestão de Associações Desenvolvido por <u>Serafim Technologies</u></span>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script type="module">
  import { requireAuth } from "./firebase.js";
  import { auth, db } from "./firebase.js";
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  requireAuth({ requiredRole: ["Admin","Master","admin","master"] });

  const opNameEl = document.getElementById("opName");
  const opRoleEl = document.getElementById("opRole");
  const normalizeRole = (r)=> String(r||"").trim().toLowerCase();

  auth.onAuthStateChanged(async (user)=>{
    if(!user) return;
    try{
      const snap = await getDoc(doc(db,"users",user.uid));
      const d = snap.exists()? snap.data() : {};
      opNameEl.textContent = d.nome || "Operador(a)";
      const role = normalizeRole(d.role) || "admin";
      opRoleEl.textContent = role;
      opRoleEl.classList.remove("d-none");
    }catch{}
  });

  document.getElementById("btnLogout")?.addEventListener("click", async ()=>{
    try{ await signOut(auth); location.href = "login.html"; }
    catch(e){ alert("Não foi possível sair: " + e.message); }
  });
</script>
</body>
</html>
