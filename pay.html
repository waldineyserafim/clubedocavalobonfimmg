<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Clube do Cavalo - Bonfim MG</title>
  <meta name="description" content="Clube do Cavalo – eventos, associados, diretoria e parcerias.">
  <meta property="og:image" content="https://clubedocavalobonfim.com.br/assets/img/logo_CCBMG.png">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="assets/css/custom.css">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="assets\img\logo_CCBMG.png">
  <link rel="shortcut icon" href="assets\img\logo_CCBMG.png" type="image/png">

  <style>
    .bg-primary { background-color: #111279 !important; }
    .btn-primary { background-color: #111279 !important; border-color: #111279 !important; }
    .btn-outline-primary { color: #111279 !important; border-color: #111279 !important; }
    .text-primary { color: #111279 !important; }
    .plan-card:hover { box-shadow: 0 .5rem 1rem rgba(0,0,0,.08); }
    .badge-save { background:#2a9d8f; }
      .brand-logo{
      height: 36px; width:auto; margin-right:.5rem; object-fit:contain;
      filter:brightness(0) invert(1);
    }
    @media (min-width: 992px){ .brand-logo{ height:42px; } }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
  <div class="container">
    <img class="brand-logo" src="assets/img/logo_CCBMG.png?v=ccbmg-2025-09-10d" alt="Logo Clube do Cavalo">
    <a class="navbar-brand fw-bold" href="index.html">Clube do Cavalo - Bonfim MG</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Alternar navegação">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="nav">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="events.html">Eventos</a></li>
        <li class="nav-item"><a class="nav-link" href="partners.html">Parcerias</a></li>        
        <li class="nav-item"><a class="nav-link" href="gallery.html">Fotos</a></li>
        <li class="nav-item"><a class="nav-link" href="board.html">Diretoria</a></li>
        <li class="nav-item"><a class="nav-link" href="sobre.html">Sobre o Clube</a></li>        
        <li class="nav-item"><a class="btn btn-light text-primary ms-lg-3" href="login.html">Área do Associado</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container my-4">
  <h1 class="h4 mb-2">Pagamento da Associação</h1>
  <p class="text-muted">Selecione o período desejado e conclua o pagamento para ativar sua associação.</p>

    <!-- Botão Voltar -->
  <div class="mb-3">
    <button id="btnVoltar" class="btn btn-outline-secondary">
      ← Voltar
    </button>
  </div>

  <div class="alert alert-info py-2" role="status">
    <strong id="status">Carregando seu status...</strong>
  </div>

  <!-- Planos -->
  <div class="row g-3" id="planos">
    <div class="col-md-4">
      <label class="card h-100 p-0 plan-card">
        <div class="card-body">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="plano" id="planoMensal" value="mensal">
            <label class="form-check-label fw-semibold" for="planoMensal">Mensal</label>
          </div>
          <div class="mt-2">
            <div class="fs-4 fw-bold">R$ 30</div>
            <div class="text-muted small">Renovação a cada mês</div>
          </div>
        </div>
      </label>
    </div>

    <div class="col-md-4">
      <label class="card h-100 p-0 plan-card">
        <div class="card-body">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="plano" id="planoTrimestral" value="trimestral">
            <label class="form-check-label fw-semibold" for="planoTrimestral">Trimestral</label>
          </div>
          <div class="mt-2">
            <div class="d-flex align-items-center gap-2">
              <div class="fs-4 fw-bold">R$ 85</div>
              <span class="badge badge-save">-4%</span>
            </div>
            <div class="text-muted small">Você economiza em relação ao mensal</div>
          </div>
        </div>
      </label>
    </div>

    <div class="col-md-4">
      <label class="card h-100 p-0 plan-card">
        <div class="card-body">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="plano" id="planoSemestral" value="semestral">
            <label class="form-check-label fw-semibold" for="planoSemestral">Semestral</label>
          </div>
          <div class="mt-2">
            <div class="d-flex align-items-center gap-2">
              <div class="fs-4 fw-bold">R$ 170</div>
              <span class="badge badge-save">-8%</span>
            </div>
            <div class="text-muted small">Mais economia por semestre</div>
          </div>
        </div>
      </label>
    </div>
  </div>

  <!-- Ações -->
  <div class="card mt-3">
    <div class="card-body">
      <div id="selecionado" class="mb-3 text-secondary">Nenhum plano selecionado.</div>

      <!-- Botão dinamicamente exibido ao escolher o plano -->
      <a id="btnPagar" class="btn btn-primary w-100 d-none" target="_blank" rel="noopener">Pagar com Mercado Pago</a>

      <p class="text-muted mt-3 mb-0" id="msg"></p>
    </div>
  </div>

  <div class="alert alert-secondary mt-3 mb-0 small" role="note">
    <strong>Quer plano anual ou outras condições (ex.: familiar, corporativo)?</strong>
    <a class="link-underline link-underline-opacity-0" href="https://wa.me/5531991297695?text=Olá!%20Gostaria%20de%20conversar%20sobre%20planos%20da%20associação%20do%20Clube%20do%20Cavalo." target="_blank" rel="noopener">
      Entre em contato com a Diretoria do Clube para combinar a melhor opção.
    </a>
  </div>
</main>

<footer class="mt-5 py-4 bg-body-tertiary border-top">
  <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
    <div>
      <strong>Clube do Cavalo - Bonfim MG</strong> — Promovendo a cultura equestre.
    </div>
    <div class="text-secondary small text-center">© 2025 Clube do Cavalo - Bonfim MG. Todos os direitos reservados.<br>
      <span>Sistema de Gestão de Associações Desenvolvido por <u>Serafim Technologies</u></span>
    </div>
  </div>
</footer>

<script type="module">
  // ===== Versões alinhadas (Firebase 11.0.1) =====
  import { auth, db } from "./firebase.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  import { signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  // Botão voltar: faz logout e redireciona
  document.getElementById("btnVoltar").addEventListener("click", async () => {
    try {
      await signOut(auth);
    } catch (e) {
      console.warn("Erro ao sair:", e);
    }
    window.location.href = "index.html";
  });
  
  // ====== CONFIG: links do Mercado Pago por plano ======
  // Substitua cada URL pelos seus links reais (Checkout Pro / Link de pagamento)
  const MP_LINKS = {
    mensal:     "https://mpago.la/2wZL3WC",
    trimestral: "https://mpago.la/2Nua1PS",
    semestral:  "https://mpago.la/1XUhw5D",
  };

  const statusEl       = document.getElementById("status");
  const selecionadoEl  = document.getElementById("selecionado");
  const btnPagar       = document.getElementById("btnPagar");
  const msg            = document.getElementById("msg");
  const radios         = Array.from(document.querySelectorAll('input[name="plano"]'));

  let uid = null;
  let planoSelecionado = null;

  // Atualiza UI do botão conforme seleção
  function atualizarUIPlano() {
    if (!planoSelecionado) {
      btnPagar.classList.add("d-none");
      btnPagar.removeAttribute("href");
      selecionadoEl.textContent = "Nenhum plano selecionado.";
      return;
    }

    const labels = {
      mensal: "Mensal — R$ 30",
      trimestral: "Trimestral — R$ 85 (4% off)",
      semestral: "Semestral — R$ 170 (8% off)",
    };

    const link = MP_LINKS[planoSelecionado];
    selecionadoEl.textContent = `Plano selecionado: ${labels[planoSelecionado]}`;

    if (link) {
      btnPagar.href = link;
      btnPagar.textContent = "Pagar Agora";
      btnPagar.classList.remove("d-none");
    } else {
      // Caso esqueça de configurar o link
      btnPagar.classList.add("d-none");
      btnPagar.removeAttribute("href");
      msg.textContent = "Link de pagamento não configurado para este plano. Contate a diretoria.";
    }
  }

  // Carrega status do associado
  async function carregarStatus() {
    if (!uid) return;
    const snap = await getDoc(doc(db, "users", uid));
    const data = snap.exists() ? snap.data() : {};
    const status = data.status || "Pagamento Pendente";
    statusEl.textContent = `Status atual: ${status}`;

    const ativo = String(status).toLowerCase() === "ativo";

    // Se já estiver ativo, evita novo pagamento acidental
    radios.forEach(r => r.disabled = ativo);
    if (ativo) {
      btnPagar.classList.add("d-none");
      btnPagar.removeAttribute("href");
      selecionadoEl.textContent = "Sua associação está ativa. Obrigado!";
      msg.textContent = "";
    } else {
      // Se não ativo, permite escolher um plano
      radios.forEach(r => r.disabled = false);
      atualizarUIPlano();
      // Mensagem ajustada (sem "Recarregar status")
      msg.textContent = "Após pagar, aguarde o processamento do seu pagamento e liberaremos seu acesso. Obrigado!";
    }
  }

  // Autenticação obrigatória
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "./login.html";
      return;
    }
    uid = user.uid;
    carregarStatus();
  });

  // Seleção de plano
  radios.forEach(radio => {
    radio.addEventListener("change", () => {
      planoSelecionado = radio.checked ? radio.value : null;
      atualizarUIPlano();
    });
  });
</script>
</body>
</html>
